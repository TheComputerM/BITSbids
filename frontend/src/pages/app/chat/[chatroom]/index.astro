---
import { Container, HStack } from "styled-system/jsx";
import ChatInput from "./_/chat-input";
import ChatMessage from "./_/chat-message";
import AppLayout from "~/layouts/AppLayout.astro";
import { TbChevronLeft } from "solid-icons/tb";
import UserAvatar from "~/components/user-avatar";
import { Text } from "~/components/ui/typography";
import { iconButton } from "styled-system/recipes";
import { getUser } from "~/lib/api/user";

const session = (await Astro.locals.auth.validate())!;
const user = await getUser(session.user.userId);
---

<AppLayout title="Chatroom">
  <Container bg="bg.subtle">
    <HStack h="14">
      <a href="../chat" class={iconButton({ variant: "ghost" })}>
        <TbChevronLeft />
      </a>
      <UserAvatar client:idle user={user} />
      <Text fontWeight="semibold">{user.name}</Text>
    </HStack>
  </Container>

  <Container display="flex" flexDirection="column" py="4" gap="6">
    <ChatMessage message="Hi" fromUser={true} />
    <ChatMessage message="Hello There" />
    <ChatInput />
  </Container>
</AppLayout>